<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Selection - Audit System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/restaurant_audit/css/audit-restaurants.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo">RestaurantAudit</div>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">U</div>
                <span id="user-name">Loading...</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header fade-in">
            <h1 class="page-title">Restaurant Management</h1>
            <p class="page-subtitle">Manage your restaurant audits, scheduled visits, and daily operations</p>
        </div>

        <!-- Tab Container -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('regular-assigned')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    Regular Assigned Restaurant
                </button>
                <button class="tab-button" onclick="switchTab('daily-audit')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Daily Audit (Manager)
                </button>
            </div>

            <!-- Regular Assigned Restaurant Tab -->
            <div id="regular-assigned-content" class="tab-content active">
                <!-- Scheduled Audit Section -->
                <div class="scheduled-audit-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                            <line x1="8" y1="14" x2="16" y2="14"/>
                            <line x1="8" y1="18" x2="12" y2="18"/>
                        </svg>
                        Schedule Your Weekly Audits
                    </h3>
                    <div class="schedule-form">
                        <div class="form-group">
                            <label for="restaurant-select">Select Restaurant</label>
                            <select id="restaurant-select">
                                <option value="">Choose a restaurant...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="visit-date">Visit Date</label>
                            <input type="date" id="visit-date" min="">
                        </div>
                        <button class="schedule-btn" onclick="scheduleAudit()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Schedule Audit
                        </button>
                    </div>

                    <!-- Scheduled Visits Display -->
                    <div id="scheduled-visits-container">
                        <div class="scheduled-visits-grid" id="scheduled-visits-grid">
                            <!-- Scheduled visits will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls fade-in">
                    <div class="search-box">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <input type="text" class="search-input" id="search-input" placeholder="Search restaurants...">
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterRestaurants('all')">All</button>
                        <button class="filter-btn" onclick="filterRestaurants('active')">Active</button>
                        <button class="filter-btn" onclick="filterRestaurants('pending')">Pending</button>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    Loading restaurants...
                </div>

                <!-- Error State -->
                <div id="error" class="error" style="display: none;"></div>

                <!-- Restaurants Grid -->
                <div id="restaurants-container" class="restaurants-grid" style="display: none;"></div>

                <!-- Empty State -->
                <div id="empty-state" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">🏪</div>
                    <h3>No Restaurants Available</h3>
                    <p>You don't have any restaurants assigned to your account. Please contact your administrator.</p>
                </div>

                <!-- My Scheduled Visits Table -->
                <div class="my-visits-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11l3 3 8-8"/>
                            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.51 0 2.93.37 4.18 1.03"/>
                        </svg>
                        My Scheduled Visits for the Week
                    </h3>
                    <table class="visits-table" id="my-scheduled-visits-table">
                        <thead>
                            <tr>
                                <th>Restaurant</th>
                                <th>Next Audit Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="my-visits-tbody">
                            <!-- Scheduled visits will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Dashboard Stats -->
                <div class="stats-grid fade-in" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-restaurants">0</div>
                        <div class="stat-label">Available Restaurants</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-audits">0</div>
                        <div class="stat-label">Total Audits</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pending-progress">0</div>
                        <div class="stat-label">Pending Progress</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-score">0</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                </div>
            </div>

            <!-- Daily Audit (Manager) Tab -->
            <div id="daily-audit-content" class="tab-content">
                <!-- Template Management Section -->
                <div class="template-management-section">
                    <div class="section-header">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                            Daily Audit Templates
                        </h3>
                        <div style="font-size: 0.875rem; color: var(--neutral-600);">
                            Templates are managed from ERPNext backend
                        </div>
                    </div>

                    <!-- Template Status Info -->
                    <div class="time-controls-section">
                        <h4>Current Template Status</h4>
                        <div class="schedule-info">
                            <div class="info-card">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                                <span id="current-template-status">Loading template status...</span>
                            </div>
                            <div class="info-card">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                                <span>Templates are controlled by backend settings</span>
                            </div>
                        </div>
                        <div style="background: var(--neutral-100); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <h5 style="margin-bottom: 0.5rem; color: var(--neutral-700);">How to manage templates:</h5>
                            <ul style="margin: 0; padding-left: 1.5rem; color: var(--neutral-600); font-size: 0.875rem;">
                                <li>Go to ERPNext backend → Restaurant Audit → Daily Audit Template</li>
                                <li>Create new templates with time settings</li>
                                <li>Templates automatically close before cashier opening time</li>
                                <li>Assign templates to specific restaurants or all restaurants</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Active Templates List -->
                    <div class="templates-list" id="templates-list">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>

                <!-- Daily Audit Stats -->
                <div class="daily-stats-section">
                    <h3>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        Today's Audit Statistics
                    </h3>
                    <div class="daily-stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="today-completed-audits">0</div>
                            <div class="stat-label">Completed Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="today-pending-audits">0</div>
                            <div class="stat-label">Pending Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="templates-active">0</div>
                            <div class="stat-label">Active Templates</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avg-completion-time">0</div>
                            <div class="stat-label">Avg Completion (min)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Visit Modal -->
    <div class="schedule-modal" id="schedule-visit-modal">
        <div class="schedule-modal-content">
            <div class="schedule-modal-header">
                <h3 class="schedule-modal-title">Schedule Visit</h3>
                <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
            </div>
            <div class="schedule-modal-body">
                <div class="form-group">
                    <label for="modal-restaurant-name">Restaurant</label>
                    <input type="text" id="modal-restaurant-name" readonly style="background: var(--neutral-50);">
                </div>
                <div class="form-group">
                    <label for="modal-visit-date">Visit Date</label>
                    <input type="date" id="modal-visit-date" min="">
                </div>
            </div>
            <div class="schedule-modal-footer">
                <button class="btn btn-secondary" onclick="closeScheduleModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmScheduleVisit()">Schedule Visit</button>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal" id="progress-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Continue Previous Audit?</div>
                <div class="modal-subtitle" id="progress-details">You have saved progress for this restaurant.</div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="startNewAudit()">Start New Audit</button>
                <button class="modal-btn primary" onclick="continueAudit()">Continue Progress</button>
            </div>
        </div>
    </div>

    <script src="/assets/restaurant_audit/js/audit-restaurants.js"></script>
</body>
</html>